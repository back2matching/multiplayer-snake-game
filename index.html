<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
    </style>
</head>
<body>
    <script>
    const GRID_SIZE = 22;
    const CELL_SIZE = 15;
    const GAME_WIDTH = GRID_SIZE * CELL_SIZE;
    const GAME_HEIGHT = GRID_SIZE * CELL_SIZE;

    let gameState = 'menu';
    let aiDifficulty = 'medium';

    const config = {
        type: Phaser.AUTO,
        width: GAME_WIDTH,
        height: GAME_HEIGHT,
        backgroundColor: '#000000',
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);
    let cursors;
    let player;
    let ai;
    let food;
    let playerScore = 0;
    let aiScore = 0;
    let scoreText;
    let gameOver = false;
    let startButton;
    let restartButton;
    let eatSound;
    let gameOverSound;
    let border;

    function preload() {
        // Instead of loading external audio files, we'll use base64 encoded audio
        this.load.audio('eat', 'data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAFbgCenp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6e//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAUAAAAAAAAABWgVbKAYAAAAAAD/+1DEAVMEAB4AAAAAAAA0gAAAABFISEbISEhI+QkJH//7UMQVAAzM7Uj0AAAgAAA0goAAAGbISPhI+EhIQhISEhISEhISEhISEn/+5DE04AAAAGkAAAAIAAANIAAAASEhISEhISEhISEhISEhISEhISEhISE');
        this.load.audio('gameover', 'data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAFbgCenp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6enp6e//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAUAAAAAAAAABWgVcKAYAAAAAAD/+1DEAVMEAB4AAAAAAAA0gAAAABFISEbISEhI+QkJH//7UMQVAAzM7Uj0AAAgAAA0goAAAGbISPhI+EhIQhISEhISEhISEhISEn/+5DE04AAAAGkAAAAIAAANIAAAASEhISEhISEhISEhISEhISEhISEhISE');
    }

    function create() {
        console.log("Create function called");
        cursors = this.input.keyboard.createCursorKeys();
        
        // We'll create the sounds, but not play them yet
        eatSound = this.sound.add('eat');
        gameOverSound = this.sound.add('gameover');
        
        createMenu(this);
        
        // Add a pointer down event to start the audio context
        this.input.on('pointerdown', function () {
            if (game.sound.context.state === 'suspended') {
                game.sound.context.resume();
            }
        });
    }

    // ... [rest of the code remains the same]

    function eatFood(snake) {
        if (game.sound.context.state === 'running') {
            eatSound.play();
        }
        if (snake === player) {
            playerScore += 10;
        } else {
            aiScore += 10;
        }
        scoreText.setText(`Player: ${playerScore}  AI: ${aiScore}`);

        let tail = snake.body[snake.body.length - 1];
        let newSegment = game.scene.scenes[0].add.rectangle(
            tail.x, tail.y, 
            CELL_SIZE * 0.75, CELL_SIZE * 0.75, 
            snake === player ? 0x00ff00 : 0xff0000
        );
        snake.body.push(newSegment);

        spawnFood(game.scene.scenes[0]);
    }

    function endGame(winner) {
        if (game.sound.context.state === 'running') {
            gameOverSound.play();
        }
        gameState = 'gameOver';
        gameOver = true;
        game.scene.scenes[0].add.text(GAME_WIDTH/2, GAME_HEIGHT/2, `Game Over! ${winner} wins!`, 
            { fontSize: '32px', fill: '#ffffff' }).setOrigin(0.5);
        restartButton = game.scene.scenes[0].add.text(GAME_WIDTH/2, GAME_HEIGHT * 3/4, 'Restart', 
            { fontSize: '24px', fill: '#ffffff' })
            .setOrigin(0.5)
            .setInteractive()
            .on('pointerdown', () => {
                game.scene.scenes[0].scene.restart();
            });
    }
    </script>
</body>
</html>
