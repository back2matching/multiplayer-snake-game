<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
        #chatBox { position: absolute; right: 10px; top: 10px; width: 200px; height: 300px; background-color: rgba(255,255,255,0.8); overflow-y: scroll; }
        #chatInput { position: absolute; right: 10px; top: 320px; width: 200px; }
    </style>
</head>
<body>
    <div id="chatBox"></div>
    <input type="text" id="chatInput" placeholder="Type to chat...">
    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA-PdosVTGoJ1MTL3xD3XybhHJc7buUjDo",
      authDomain: "multiplayersnakegame.firebaseapp.com",
      projectId: "multiplayersnakegame",
      storageBucket: "multiplayersnakegame.appspot.com",
      messagingSenderId: "954908084436",
      appId: "1:954908084436:web:0ac77cc7cecbdd30ed9341"
    };
    firebase.initializeApp(firebaseConfig);

    const config = {
        type: Phaser.AUTO,
        width: 600,
        height: 450,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);
    let cursors;
    let player;
    let otherPlayer;
    let food;
    let gameId;
    let playerId;
    let scoreText;

    function preload() {
        this.load.image('food', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAmSURBVHjaYmRgYPj//z8DGmBiQAVMDFQGoxZSzUKQQnQZAPPTBtj9Z8k2AAAAAElFTkSuQmCC');
    }

    function create() {
        this.add.rectangle(300, 225, 600, 450, 0x000000);
        cursors = this.input.keyboard.createCursorKeys();
        food = this.add.image(300, 225, 'food');
        player = this.add.rectangle(100, 100, 20, 20, 0x00ff00);
        otherPlayer = this.add.rectangle(500, 350, 20, 20, 0xff0000);
        scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#fff' });

        gameId = prompt("Enter game ID to join, or leave blank to create new game:");
        if (!gameId) {
            gameId = Math.random().toString(36).substring(2, 15);
            alert("Your game ID is: " + gameId);
        }

        playerId = Math.random().toString(36).substring(2, 15);

        const gameRef = firebase.database().ref('games/' + gameId);
        gameRef.child('players').child(playerId).set({
            x: player.x,
            y: player.y,
            score: 0
        });

        gameRef.child('players').on('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
                const playerData = childSnapshot.val();
                if (childSnapshot.key !== playerId) {
                    otherPlayer.x = playerData.x;
                    otherPlayer.y = playerData.y;
                }
            });
        });

        gameRef.child('food').on('value', (snapshot) => {
            const foodData = snapshot.val();
            if (foodData) {
                food.x = foodData.x;
                food.y = foodData.y;
            }
        });

        spawnFood();

        gameRef.child('chat').on('child_added', (snapshot) => {
            const message = snapshot.val();
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML += `<p>${message.sender}: ${message.text}</p>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const message = this.value;
                if (message) {
                    gameRef.child('chat').push({
                        sender: playerId,
                        text: message
                    });
                    this.value = '';
                }
            }
        });
    }

    function update() {
        if (cursors.left.isDown) {
            player.x -= 3;
        } else if (cursors.right.isDown) {
            player.x += 3;
        }

        if (cursors.up.isDown) {
            player.y -= 3;
        } else if (cursors.down.isDown) {
            player.y += 3;
        }

        firebase.database().ref('games/' + gameId + '/players/' + playerId).update({
            x: player.x,
            y: player.y
        });

        if (Phaser.Geom.Intersects.RectangleToRectangle(player.getBounds(), food.getBounds())) {
            eatFood();
        }
    }

    function spawnFood() {
        const x = Math.floor(Math.random() * 580) + 10;
        const y = Math.floor(Math.random() * 430) + 10;
        firebase.database().ref('games/' + gameId + '/food').set({ x, y });
    }

    function eatFood() {
        let score = parseInt(scoreText.text.split(': ')[1]) + 10;
        scoreText.setText('Score: ' + score);
        firebase.database().ref('games/' + gameId + '/players/' + playerId).update({ score: score });
        spawnFood();
    }
    </script>
</body>
</html>
